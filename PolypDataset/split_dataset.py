"""
File generated by ChatGPT. Prompt used:

how to get this directory format?
PolypDataset/
├── Kvasir-SEG/
│   ├── train/
│   │   ├── images/
│   │   └── masks/
│   ├── validation/
│   └── test/

Right now i have:
├── Kvasir-SEG/
 
│  ├── images/ 
│  └── masks/
"""

import os
import shutil
import random

# Set paths
base_dir = "Kvasir-SEG"
images_dir = os.path.join(base_dir, "images")
masks_dir = os.path.join(base_dir, "masks")

train_dir = os.path.join(base_dir, "train")
val_dir = os.path.join(base_dir, "validation")
test_dir = os.path.join(base_dir, "test")

# Ensure the directories exist
for folder in [train_dir, val_dir, test_dir]:
    os.makedirs(os.path.join(folder, "images"), exist_ok=True)
    os.makedirs(os.path.join(folder, "masks"), exist_ok=True)

# Get all image files
image_files = sorted([f for f in os.listdir(images_dir) if f.endswith(('.png', '.jpg', '.jpeg'))])

# Shuffle images for randomness
random.seed(58800)  # For reproducibility
random.shuffle(image_files)

# Split percentages (based on ducknet paper)
train_split = 0.8
val_split = 0.1
test_split = 0.1

# Compute split indices
total_images = len(image_files)
train_count = int(total_images * train_split)
val_count = int(total_images * val_split)

# Assign to sets
train_files = image_files[:train_count]
val_files = image_files[train_count:train_count + val_count]
test_files = image_files[train_count + val_count:]

# Function to move files
def move_files(file_list, target_folder):
    for file in file_list:
        shutil.move(os.path.join(images_dir, file), os.path.join(target_folder, "images", file))
        shutil.move(os.path.join(masks_dir, file), os.path.join(target_folder, "masks", file))

# Move files
move_files(train_files, train_dir)
move_files(val_files, val_dir)
move_files(test_files, test_dir)

print("Dataset successfully split into train, validation, and test sets!")
